#!/bin/bash

set -e  # Exit on first error
trap 'echo -e "[!] An error occurred. Exiting." | lolcat' ERR

GITHUB_USER="jaspreet-infosec"
SHELL_SCRIPT_REPO="ShellScripting"
SECLISTS_DIR="/usr/share/seclists"

# Function for colorful info messages
info() {
    echo -e "[+] $1" | lolcat
}

# Function to install a package if it's not already installed
install_if_missing() {
  if ! dpkg -l | grep -q "$1"; then
    info "Installing missing package: $1"
    sudo apt-get install -y "$1"
  fi
}

# Install lolcat for colorful output
info "Installing lolcat for colorful output..."
sudo apt-get install -y lolcat

# System update and upgrade
info "Updating and upgrading the system..."
sudo apt-get update -y && sudo apt-get upgrade -y && sudo apt-get dist-upgrade -y

# Install essential packages
info "Installing essential tools and dependencies..."
sudo apt-get install -y git wget curl nmap python3 python3-pip gedit mousepad \
    build-essential net-tools aircrack-ng sqlmap metasploit-framework \
    john hydra nikto gobuster seclists dirb zmap tmux burpsuite subfinder \
    wireshark netcat tshark bloodhound

# Clone required GitHub repositories
info "Cloning required GitHub repositories..."
REPOS=(
  "HACK-CAMERA"
  "XERXES"
  "CamPhish"
  "zphisher"
  "ErisPhisher"
)

for repo in "${REPOS[@]}"; do
  if [ -d "$repo" ]; then
    info "$repo already exists, skipping..."
  else
    git clone "https://github.com/$GITHUB_USER/$repo.git"
  fi
done

# Clone additional security tools
OTHER_REPOS=(
  "https://github.com/rapid7/metasploit-framework.git"
  "https://github.com/zaproxy/zap-core-help.git"
  "https://github.com/zeek/zeek.git"
)

for repo in "${OTHER_REPOS[@]}"; do
  repo_name=$(basename "$repo" .git)
  if [ -d "$repo_name" ]; then
    info "$repo_name already exists, skipping..."
  else
    git clone "$repo"
  fi
done

# Make all .sh files and XERXES binary executable
info "Giving executable permissions to .sh files and XERXES..."
find . -type f -iname "*.sh" -exec chmod +x {} \;
chmod +x ./XERXES/xerxes 2>/dev/null || true

# Clone ShellScripting repo
info "Cloning ShellScripting repository..."
if [ -d "$SHELL_SCRIPT_REPO" ]; then
  info "$SHELL_SCRIPT_REPO already exists, skipping..."
else
  git clone "https://github.com/$GITHUB_USER/$SHELL_SCRIPT_REPO.git"
fi

# Download SecLists if not already present
info "Checking for SecLists..."
if [ ! -d "$SECLISTS_DIR" ]; then
  sudo git clone https://github.com/danielmiessler/SecLists.git "$SECLISTS_DIR"
else
  info "SecLists already exists, skipping download."
fi

# Install Python packages
info "Installing Python packages..."
pip3 install --upgrade pip
pip3 install requests bs4

# Additional setup for network tools
info "Setting up Wireshark and network tools..."
install_if_missing "wireshark"
install_if_missing "tshark"
install_if_missing "netcat"

# Install all other dependencies
info "Installing additional dependencies..."
sudo apt-get install -y build-essential libssl-dev libffi-dev python-dev

# Final cleanup
info "Cleaning up unnecessary packages..."
sudo apt-get autoremove -y && sudo apt-get clean

info "Setup Complete! Your system is ready for ethical hacking."
